---
title: "Exercises"
linktitle: "4. Grouping and tables"
date: "2020-08-03"
publishdate: "2020-08-03"
menu:
  exercise:
type: docs
output:
  blogdown::html_page:
    toc: true
    toc_depth: 2
    number_sections: true
    pandoc_args: ["--number-offset=3"]
---
```{r setup, include = FALSE}
knitr::opts_chunk$set(
  error = TRUE,
  collapse = TRUE,
  comment = "#> ",
  class.output = "output",
  class.message = "message",
  class.error = "message"
)
```
# Grouping and tables
## Prepare

Download the materials for this week's exercises here: 

```{r, eval = FALSE}
library(tidyverse)
nlsy <- read_csv("nlsy_cc.csv")
```
```{r, echo = FALSE}
library(tidyverse)
nlsy <- read_csv(here::here("static", "data", "nlsy_cc.csv"))
```

## Using pipes

### Translate code {-}

Consider the following instructions for making a dataset:

1. Create a variable called `slp_cat_wkday` categorizing weekday sleep.
2. Subset the dataset to only include people with missing values.
2. Remove non-sleep-related variables from the dataset.
4. Call your finished dataset `missing_sleep`.

I've followed these instructions here.
```{r}
nlsy2 <- mutate(nlsy, slp_cat_wkdy = case_when(
  sleep_wkdy < 5 ~ "little",
  sleep_wkdy < 7 ~ "some",
  sleep_wkdy < 9 ~ "ideal",
  sleep_wkdy < 12 ~ "lots",
  TRUE ~ NA_character_))
missing_sleep <- filter(nlsy2, is.na(slp_cat_wkdy))
missing_sleep <- select(missing_sleep, starts_with("slp"), contains("sleep"))
missing_sleep
```


Now follow the instructions using pipes.

```{r}

```

### Order of operations {-}

Experiment with switching up the "order of operations". Can you complete the instructions in a different order and get the same result? Can you think of a situation when you might not be able to do so?

```{r}

```

## Summary statistics

### Correlation {-}

Among the only children, find the correlation between hours of sleep on weekdays and weekends.

```{r}

```

### Proportions {-}

Create a variable that is 1 if an observation has an income between 20,000 and 30,000, and 0 otherwise. Calculate the proportion of people in the dataset who fit that criterion.

```{r}

```


### `summary()` reimagined {-}

Recreate the `summary()` function using `summarize()` (i.e., produce all the same statistics) for a variable of your choice.

```{r}

```

## Stratified summary statistics

### By region {-}

Find the median income per region. Before doing so, make sure that you've made region into a factor variable with appropriate names so we can easily read your results.

```{r}

```

### By a new variable {-}

Calculate and compare the median income for people who sleep at least 8 hours on weekdays and those who sleep less.

```{r}

```

### Proportions by region {-}

Among the women (`sex = 2`), calculate the proportion who live in each region.

```{r}

```

## Tables with the `tableone` package

### Prepare a dataset {-}

Apply the following inclusion criteria to the NLSY dataset to make a analysis dataset: from region 1 or 4, with at least 2 siblings, and doesn't wear glasses.

```{r}

```

### Make a stratification variable {-}

Make a variable in that dataset that categorizes people in quartiles (split at 25th, 50th, and 75% percentiles of the new dataset) by income. Make sure the categories have descriptive names.

```{r}

```

### Make table 1 {-}

If you have never installed the `tableone` package, you'll need to do that first:
```{r, eval = FALSE}
install.packages("tableone")
```

Make a table 1 for this new dataset, stratified by the new income variable. Make sure they show up in the correct order in your table. Include p-values testing across strata but only print 2 digits for them. Perform an exact test for the region comparison.

```{r}
library(tableone)

```

### Share your table 1 {-}

You can use this code to help get your table 1 in an easy-to-share format:

```{r, eval = FALSE}
# assume you've made a table1 with table1 <- CreateTableOne(...)
table1_to_share <- table1 %>% 
  print() %>% 
  as_tibble(rownames = "id")
write_csv(table1_to_share, "table1.csv")
```

Open up the `table1.csv` file in another program (Excel, Google Sheets, etc.) and check it out!